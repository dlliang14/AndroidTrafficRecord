# Android Traffic Record (ATRuins)

## 简介

这个一个测试安卓手机app的ipv6占比情况的自动化测试脚本。init.py里是目前的逻辑，把关闭app相关的逻辑都去除了，来模拟网信办。__init__origin.py是最初的测试脚本。

## 文件说明

- `ATRuins.py`: 主脚本文件，包含自动化测试的主要逻辑。
- `__init__.py`: 当前逻辑实现，去除了关闭应用相关的逻辑。
- `__init__origin.py`: 最初的测试脚本，包含完整的测试逻辑。

## 使用方法

1. 确保已安装必要的依赖项。
2. 准备一个包含应用包名的文件，或直接提供单个包名。
3. 运行脚本：

```sh
python ATRuins.py -i <包名文件路径或单个包名> [-l]
```

### 环境要求

- Python 3.7.8或以上版本
- Windows 操作系统
- 安卓设备（已root），目前支持最好的是Google系列Nexus、Pixel手机、小米10、小米6x、华为Mate8
- 请确保手机的网络同时处于IPv4与IPv6环境下，可以通过 [https://www.test-ipv6.com](https://www.test-ipv6.com) 进行测试，下图是测试结果示例

### 命令行参数

使用 `ATRgo -h` 命令可以查看帮助解释：

- `-i`: 本地APK所在的完整路径
- `-b`: 标识SIM卡的运营商名称 (0: 中国电信, 1: 中国联通, 2: 中国移动)
- `-t`: 禁止使用Monkey(全手动模式)
- `-d`: 用于存放下载后的APK文件的目录路径
- `-p`: 用于存放从安卓设备上下载的pcap文件的目录路径
- `-w`: 在Monkey测试之前的延迟等待时间（单位：秒）
- `-m`: Monkey测试的次数
- `-ps`: 从安卓测试设备上下载的pcap文件大小阈值（pcap文件小于此阈值则拒绝解析）
- `-psm`: 抓取流量过程中pcap文件大小阈值上限，一旦抓取的流量生成的pcap文件大小大于这个阈值，则直接停止测试
- `-da`: 测试后是否禁用应用
- `-itl`: 安装应用的最长时间限制（单位：秒），若安装时间超过这个时间限制，则重新启动安装流程（为了避免由于手机卡顿或硬件连接扰动导致的安装卡住）
- `-l`: 测试过程中显示详细的日志输出

### 简单的使用范例

#### 使用包名文件

```sh
# 自动测试
ATRgo -b 1 -ps 10 -psm 50 -w 1 -m 1600 -i apk路径

# 人工测试
ATRgo -b 1 -t -ps 10 -psm 50 -i apk路径

# -b 1
# 0: 中国电信, 1: 中国联通, 2: 中国移动

# -t 人工测试
```

## 贡献

欢迎提交问题和贡献代码。
